# Game Events Generator

This part generates fake game events that are sent to an event hub, processed by Azure Stream Analytics queries, stored in Azure blob storage and visualised in a Power BI Dashboard in real time.

This part includes

* Console application to generate game events
* Event hub
* Sample data
* Azure Stream Analytics queries
* Power BI Dashboard
* Next steps

## Console Application - Game Events Generator

Fake game events are being generated and sent to an event hub.
Assumptions:
* 5 game IDs
* maximum session length: 300 seconds = 5 minutes
* crash probability of 10%

A game event is of the following format:
```json
{
    "time":"2016-08-09T14:47:19.3083110Z",
    "PlayerId":"Haohannon",
    "GameId":"3",
    "GameActivity":"0",
    "Latitude":"-24.87906411",
    "Longitude":"152.3508968",
    "City":"Bundaberg",
    "Country":"Australia",
    "EventProcessedUtcTime":"2016-08-09T14:49:28.8072191Z",
    "PartitionId":1,
    "EventEnqueuedUtcTime":"2016-08-09T14:47:17.7680000Z"
}
```

GameActivity indicates if it is a start or stop event.
* GameActivity=1 --> game session started
* GameActivity=0 --> game session stopped

In the console application, we make use of a class EventBuffer to which GameEvents are added in every given time intervals. We differentiate between two types of GameEvents: EntryEvent and ExitEvent. For every EntryEvent that is created and added to the eventBuffer, at most one ExitEvent is added - according to a defined crash probability.


## Event Hub
One event hub as opposed to two event hubs for two separate incoming data streams: entry events and exit events. These can be differentiated using the field GameActivity.
Currently running in Olivia's internal Azure subscription.

## Sample Data
Sample data can be found under [GameEventsGenerator/Data](/GameEventsGenerator/GameEventsGenerator/Data):

* raw: Game events that are generated by the console application and sent to the event hub in json format. To be found in json and csv format.
* entry.json and exit.json: deprecated. Game events originally sent separately to two different event hubs.
* GamerNames.csv: supposedly popular gamer names, used for the fake game events.
* ccus.json: mumber of concurrent users per game per hopping window. Output of an Azure Stream Analytics query (see more details in Azure Stream Analytics Queries)
* duration.json: session lengths per player per game
* world_cities.csv: world cities with their associated latitude and longitude coordinates

## Azure Stream Analytics Queries
Current ASA queries can be found in [ASA-Scripts-singlestream.sql](/GameEventsGenerator/GameEventsGenerator/Scripts/ASA-Scripts-singlestream.sql) for session durations and concurrent users. Outputs of queries go to blob storage and power BI.

## Power BI Dashboard
* Dashboard: Game Analytics
* Datasets:
    * Number of concurrent users
    * Session durations: Interesting to find out which games are played the most, which ones are played the longest, etc.
    * Geo locations: Where are most of my players (=size of bubbles) and how long do they play (=redness of bubble)

## Next Steps
* cold path, e.g. Azure SQL DB
* natural language 
* add city & country


## Questions for Demo
* Where are the people from
* what game are the German people playing?
* where in germany?
* what cities are the most players from?
* Brazil, Rio, Cologne
* give me CCUs from Germany as a map / pie
* pinning these questions to dashboard


## Questions that work
* which country has the highest number of playerid / which country has the most playerids
* how many playerids are in Germany?  
* numactivesessions by country
* how many playerids right now